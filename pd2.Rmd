---
title: "Práctica dirigida 2"
output:
  html_document:
    toc: yes
    toc_float: yes
    collapsed: no
    number_sections: no
    toc_depth: 3
    theme: flatly
    highlight: textmate
    always_allow_html: yes
---

**FACULTAD DE CIENCIAS SOCIALES - PUCP**

Curso: SOC294 - Estadística para el análisis sociológico 1

Semestre 2025 - 2

En R, tenemos vectores, matrices, data.frames y listas.\
Entender la lógica de estos objetos es importante antes de iniciar el trabajo con data secundaria.

# 1. CREAR SETS DE DATOS

## CREAR VECTORES

Un vector es una coleccion de uno o mas datos del mismo tipo. Un vector puede incluir datos numericos, datos en texto o datos logicos (verdadero/falso).

**Vector de cadena de texto**

```{r a}
pais=c("Bolivia", "Colombia", "Ecuador", "Peru", "Argentina", "Brasil", "Chile", "Paraguay", "Uruguay")
pais
```

**Vector numerico**

```{r b}
hab2022_millones=c(12.22, 51.87, 18, 34.05, 46.23, 215.3, 19.6, 6.8, 3.4)
hab2022_millones
```

**Vector logico**

```{r c}
miembro_CAN=c(TRUE, TRUE, TRUE, TRUE, FALSE, FALSE, FALSE, FALSE, FALSE)
```

**Para visualizar los vectores que hemos creado** podemos colocar el nombre de los vectores creados (`pais`, `hab2022_millones`, `miembro_CAN`) o utilizar la funcion `print`.


## UNIR VECTORES EN UNA MATRIZ

Los vectores pueden unirse en una matriz. Una matri es una estructura de datos bidimensional (files y columnas) que coniene elementos del mismo tipo (solo datos numéricos o solo caracteres).

```{r d}
datosA <-cbind(pais, hab2022_millones, miembro_CAN) # cbind() une vectores, interpretando cada uno como una columna 
datosA
```

```{r e}
datosB <-rbind(pais, hab2022_millones, miembro_CAN) # rbind() une vectores, interpretando cada uno como una fila
datosB 
```
Como es posible observar, a pesar de que los vectores iniciales eran numéricos, de texto y lógicos, al unirse en una matriz, todos son interpretados como `cadenas de texto (chr)`. 
```{r f}
str(datosA)
```

## UNIR VECTORES EN UN SET DE DATOS (DATAFRAME)

Finalmente, podemos crear datasets uniendo vectores.\
Los dataframes, a diferencia de las matrices, permiten crear bases con datos de diferentes tipos (numericos, caracteres, factores, etc.)

```{r g}
datosC<- data.frame(pais, hab2022_millones, miembro_CAN)
datosC
```

Tambien podemos crear un dataset desde cero

```{r h}
datosD <-data.frame(pais=c("Bolivia", "Colombia", "Ecuador", "Peru", "Argentina", "Brasil", "Chile", "Paraguay", "Uruguay"), hab2022_millones=c(12.22, 51.87, 18, 34.05, 46.23, 215.3, 19.6, 6.8, 3.4), miembro_CAN=c(TRUE, TRUE, TRUE, TRUE, FALSE, FALSE, FALSE, FALSE, FALSE))
datosD
```

Para entender las diferencias entre `data.frame` y `cbind`, podemos usar el comando `class` (que nos permite ver el "tipo" de datos)

```{r i}
class(datosA) # matriz
class(datosC) # data.frame
class(datosC$miembro_CAN) #data.frame
str(datosC) #cada vector mantiene su estructura original.
```

## EJERCICIO

**Ejercicio 1:** Crea una base de datos de 3 filas y 5 columnas, que contenga un variable numerica, otra logica y otra de texto.

# 2. IMPORTAR Y EXPORTAR BASES DE DATOS

## ESTABLECER DIRECTORIO DE TRABAJO


Cuando trabajamos en R es importante definir cual es nuestro espacio de trabajo (la carpeta en la que trabajaremos y se almacenaran nuestras BD, imagenes, etc.) `getwd()` muestra el directorio de trabajo actual, mientras que `setwd()`establece el directorio de trabajo.

```{r j, include=TRUE}
getwd() # muestra el directorio de trabajo actual
setwd("C:/Users/sr.esquivesb/Documents/GitHub/Estadistica1_sociologia_2025_2.github.io") #indica el directorio de trabajo donde quiero trabajar.
```
## INSTALAR PAQUETES

Para importar/exportar algunos formatos es necesario instalar y abrir algunos paquetes.\
En caso no se encuentren disponibles podras instalarlos con `install.packages("")`. Podemos guardarlo en formatos diferentes al original\
Los paquetes que te permitiran abrir archivos en diferentes formatos son: `openxlsx` (*para archivos en xlsx*), `readxl` (*para archivos en xlsx*), `haven` (*para archivos de stata y spss*), `rio` (*para archivos en diferentes formatos*) entre otros.\

Instalamos las librerias que usaremos en este laboratorio `rio`, `dplyr`, `lubridate`, `psych`
```{r k, include=FALSE, warning = FALSE}
library(rio) #abre archivos en diferentes formatos
library(dplyr) #permite manipular datos (filtrar)
library(lubridate)  # Para crear fechas de muestra
library(psych) # permite usar la función describe
```

## IMPORTAR BASES DE DATOS

Trabajaremos con la base de datos del [Siseve](http://www.siseve.pe/web/).\
R puede trabajar con diversos tipos de archivos (csv, excel, spss, stata, google, dropbox, entre otros)

**Importar archivos excel**. En este caso, importaremos nuestra base de datos que esta en excel.

```{r l}
siseve <- import("Siseve2024.xlsx") # debo colocar el nombre de la base de datos tal como se encuentra guardado. 
```

## EXPORTAR O GUARDAR BASES DE DATOS

Los comandos para guardar archivos en diferentes formatos son: `write.csv(nombredebaseenR, "nombredebase.csv")`, `write_save(nombredebaseenR, "nombredebase.sav")`, `write_dta(nombredebaseenR, "nombredebase.dta")`\
En este caso exportaremos el documento a un formato en excel (.xlsx).

```{r m, eval=FALSE, include=TRUE}

write.xlsx(siseve, file="siseve.xlsx") 
```

## EJERCICIO

**Ejercicio 2:** Descarga una base de datos de la [Plataforma Nacional de Datos Abiertos - Peru](https://www.datosabiertos.gob.pe/). Importa la base de datos a R y exportala en un formato diferente al original.

# 3. EXPLORACIONES PRELIMINARES

Realizamos algunas exploraciones
```{r n, include = TRUE}
names(siseve) # brinda el nombre de las variables 
head(siseve) # brinda una idea de la estructura de la base (10 primeros casos)
str(siseve) # brinda una idea de la estructura de la base (tipos de variables, etc.)
summary(siseve) #brinda un resumen de las variables de la base 
describe(siseve) #brinda informacion general
```

Algunas bases de datos pueden incluir miles de variables o casos que no necesariamente son de nuestro interes. Por tanto, realizaremos algunas ediciones.\ 
*Ojo: Es importante registrar siempre las ediciones y decisiones que realizamos para garantizar la replicabilidad*

## CAMBIAR NOMBRES DE LA BASE DE DATOS
Para duplicar la base de datos con otro nombre
```{r o, include = TRUE}
siseve24 <- siseve
rm(siseve) #eliminamos siseve para no confundirnos
```

## CAMBIAR NOMBRES A VARIABLES 
Esta base de datos cuenta con variables que son autoexplicativas, pero no siempre es asi. Al nombrar variables, se sugiere trabajar siempre con minusculas y sin muchos "-". 
```{r p, include = TRUE}
names(siseve24) <- c("fecha", "dre", "ugel", "nivel_educativo", "tipo_reporte", "tipo_violencia", "subtipo_violencia", "estado_reporte")
names(siseve24) 
```
Tambien puedo cambiar solo el nombre de una variable. Por ejemplo, quiero cambiar el nombre de "dre" a "region". 
```{r q, include = TRUE, warning = FALSE}
siseve24 <- rename(siseve24, region = dre)
names(siseve24) 
```
## SELECCIONAR CASOS 
Esta base de datos incluye casos desde el 2013 hasta el 2024, pero solo me interesan aquellos casos del 2023. Para esto, filtramos los casos que corresponden al 2023.\ 
*Ojo: No siempre el numero de casos coincide con el numero de filas*

```{r r, include = TRUE, warning = FALSE}
siseve23 <- siseve24 %>% 
  filter(year(fecha) == 2023) #estoy creando una nueva base
```
```{r s, include = TRUE, warning = FALSE}
nrow(siseve24) #en este caso cada fila corresponde a un caso 
nrow(siseve23) #en este caso cada fila corresponde a un caso 
```
## SELECCIONAR VARIABLES
Ahora que todos los casos pertenecen son del 2023, la variable `fecha` deja de ser relevante para mi analisis. Para eliminar la variable: 
```{r t, include = TRUE, warning = FALSE}
siseve23.1 <- siseve23 %>%
  select(-fecha)
names(siseve23.1) 
```
Solo me interesa trabajar con las variables `region`, `nivel_educativo`, `tipo_violencia`
```{r u, include = TRUE, warning = FALSE}
siseve23.2 <- siseve23.1 %>%
  select(region, nivel_educativo, tipo_violencia)
names(siseve23.2)  
```
*Este procedimiento hace mas sentido en bases de mas variables*

## EJERCICIO
**Ejercicio 3:** Crea una base de datos que solo incluya informacion del nivel secundaria del año 2023.\