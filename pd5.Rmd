---
title: "Pr√°ctica dirigida 5"
output:
  html_document:
    toc: yes
    toc_float: yes
    collapsed: no
    number_sections: no
    toc_depth: 3
    theme: flatly
    highlight: textmate
    always_allow_html: yes
editor_options: 
  markdown: 
    wrap: 72
---

**FACULTAD DE CIENCIAS SOCIALES - PUCP**

Curso: SOC294 - Estad√≠stica para el an√°lisis sociol√≥gico 1

# **Muestreo (T√©cnicas de muestreo)**

## **Tipos de muestreo en investigaci√≥n social**

Cuando investigamos en ciencias sociales no siempre podemos estudiar a
toda la poblaci√≥n (por ejemplo, a todos los j√≥venes de una ciudad). Por
eso usamos muestras, es decir, un grupo reducido de personas que nos
permiten aproximarnos a la realidad del conjunto.

Existen distintos tipos de muestreo:

-   Muestreo aleatorio simple: Cada persona de la poblaci√≥n tiene la
    misma probabilidad de ser seleccionada. Es como sacar un papelito de
    una t√≥mbola.

-   Muestreo sistem√°tico: Se selecciona cada "k-√©simo" elemento de una
    lista ordenada. Por ejemplo, elegir a cada d√©cima persona que entra
    a la universidad.

-   Muestreo estratificado: La poblaci√≥n se divide en estratos (por
    ejemplo: hombres y mujeres, o grupos de edad), y se toman muestras
    de cada estrato de manera proporcional. Esto asegura representaci√≥n
    de los diferentes subgrupos.

-   Muestreo por conglomerados (clusters): En lugar de seleccionar
    individuos, se eligen grupos completos (como colegios, barrios o
    universidades) y luego se estudia a las personas dentro de esos
    grupos.

En resumen:

-   El muestreo aleatorio simple busca igualdad de oportunidades.

-   El sistem√°tico usa un patr√≥n fijo.

-   El estratificado garantiza representaci√≥n de subgrupos.

-   El por conglomerados trabaja con grupos enteros para ahorrar tiempo
    y costos.

## **Conceptos clave para entender el muestreo**

Cuando tomamos una muestra, estamos usando herramientas estad√≠sticas que
nos permiten aproximarnos a la realidad de la poblaci√≥n. Tres ideas
centrales son:

**Variables aleatorias**. Una variable aleatoria es un n√∫mero que
resulta de un proceso de azar.

Ejemplo: si encuestamos al azar a un estudiante y registramos su edad,
esa edad es el valor de una variable aleatoria.

En sociolog√≠a, nuestras encuestas generan variables aleatorias porque
dependen de a qui√©n entrevistemos.

**Ley de los grandes** **n√∫meros.** Dice que, a medida que aumenta el
tama√±o de la muestra, el promedio de la muestra se acerca cada vez m√°s
al promedio verdadero de la poblaci√≥n.

Ejemplo: si preguntamos a 10 personas cu√°nto leen al mes, el promedio
puede variar mucho; pero si preguntamos a 1,000 personas, ese promedio
ser√° muy parecido al real de toda la ciudad.

**Teor√≠a del l√≠mite central.** Afirma que, aunque las variables
originales no tengan forma de campana, la distribuci√≥n de los promedios
de muchas muestras tiende a ser normal (curva de campana).

Esto explica por qu√© los soci√≥logos podemos usar intervalos de confianza
y pruebas estad√≠sticas: aunque la poblaci√≥n sea muy diversa, los
promedios de las muestras siguen un patr√≥n predecible.

```{r}
setwd("C:/Users/u_socialesprofesor/Documents/GitHub/Estadistica1_sociologia_2025_2.github.io")
```

```{r}
library(survey)
library(tidyverse)
library(foreign)
library(haven)
library(dplyr)

cpv <- read_dta("cpv2017_pob07mod.dta")
#View(cpv2017_pob07mod)
```

### **Muestreo Aleatorio Simple (MAS)**

```{r}
set.seed(123456) # Clave para poder replicar

#Distintas maneras de extraer aleatoriamente

mas1 <- cpv[sample(1:nrow(cpv) , size = 994), ]

mas2 <- cpv %>% 
  slice_sample(prop = 0.001)

mas3 <- cpv %>%
  slice_sample(n = 994)
```

### **Muestreo Aleatorio Estratificado (MAE)**

```{r}
set.seed(123456)# Clave para poder replicar

mae1 <- cpv %>%
  group_by(c5_p2) %>%
  slice_sample(prop = 0.001)
```

### **¬øC√≥mo introducir dise√±o muestral?**

```{r}
set.seed(123456) # Clave para poder replicar
data(api) # Ejemplo de Lumley

## MAS ##
mas_d <- svydesign(id = ~1 , fpc = ~fpc , data = apisrs)
svytotal(~enroll , mas_d)
svymean(~enroll , mas_d)
```

id = ~1
Significa que no hay conglomerados (PSU = 1). Es decir, se trata de un muestreo simple, no estratificado ni por conglomerados.

fpc = ~fpc
fpc es la correcci√≥n por poblaci√≥n finita (finite population correction).
Indica el tama√±o de la poblaci√≥n total de la cual se extrajo la muestra.
En el dataset apisrs, esa variable (fpc) tiene el valor deùëÅ, la poblaci√≥n total, asignado a cada observaci√≥n.

Esto le dice a R: ‚ÄúOye, la muestra no es con reemplazo y corresponde a una poblaci√≥n finita de tama√±o N, as√≠ que ajusta la varianza con la correcci√≥n FPC‚Äù.

data = apisrs
El dataset de ejemplo incluido en el paquete survey.
Es una muestra aleatoria simple (SRS) de escuelas en California.

```{r}
## MAE ##
set.seed(123456) # Clave para poder replicar
mae_d <- svydesign(id = ~1 , fpc = ~fpc , data = apistrat , strata = ~stype)
svytotal(~enroll , mae_d)
svymean(~enroll , mae_d)

```

### **Extraer muestra + introducir dise√±o muestral**

#### **MAS**

```{r}
## MAS 
# Extraemos muestra (MAS)
mas4 <- cpv %>%
  slice_sample(prop = 0.001)

mas4 = mutate(mas4 , fpc = 994494 , pw = 994494/994 , n = 1 , .keep = "all")
mas4_d = svydesign(id = ~1 , fpc = ~fpc , data = mas4)
mas4_dw = svydesign(id = ~1 , fpc = ~fpc , weights =~pw , data = mas4)

#Promedios
svymean(~c5_p4_1 , mas4_d)
svymean(~c5_p4_1 , mas4_dw)
```

1. fpc = 994494
Se crea una variable fpc con valor constante = 994,494.
Esto representa el tama√±o de la poblaci√≥n total (N) de donde sali√≥ la muestra.
Se usa como correcci√≥n por poblaci√≥n finita (finite population correction) al definir el dise√±o muestral.

2. pw = 994494/994
Aqu√≠ se calcula un peso muestral (pw).

Significa que cada observaci√≥n de la muestra representa a ~1000 unidades de la poblaci√≥n.

3. n = 1

Se crea una variable constante con valor 1.
Muchas veces se usa como identificador de conglomerado (id) cuando el muestreo es aleatorio simple (sin estratos ni clusters).

4. .keep = "all"

Instrucci√≥n de mutate para mantener todas las variables originales de mas4, adem√°s de las nuevas (fpc, pw, n).

#### **MAE**

```{r}
# Dummy de sexo
cpv = mutate(cpv , sexo = ifelse(c5_p2 == 1 , 1 , 0) , .keep = "all")

# Contamos para fpc (estrato)
cpv %>%
  count(sexo)

# Extraemos muestra (MAE)
mae4 <- cpv %>%
   group_by(sexo) %>%
  slice_sample(prop = 0.001)

mae4 <- mae4 %>%
  mutate(fpce = case_when(
    sexo == 0 ~ 508712 ,
    sexo == 1 ~ 485782) , .keep = "all")

mae4_d = svydesign(id = ~1 , fpc = ~fpce , data = mae4 , strata = ~sexo)

svymean(~c5_p4_1 , mae4_d)
```
